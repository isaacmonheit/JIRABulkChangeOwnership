// UpdateAllFilters
// Created by Isaac Monheit on 10-Mar-2025
// Last updated 10-Mar-2025
// 
// Updates the ownership of all the filters owned by one user (email specified below) to a new owner (email specified below)
// Run in the "Script Console" section of ScriptRunner in the 'ccc-sandbox-385' testing environment


// Enter the email of the current owner
String oldOwnerEmail = "imonheit@copyright.com"
def url = "/rest/api/3/user/picker?query=${oldOwnerEmail}"
def response = get(url).header('Content-Type', 'application/json').asObject(Map)
def oldOwnerAccountID = response.body.users.accountId[0]

return oldOwnerAccountID
def filterId = '18562'

// Enter the email of the new desired owner
String newOwnerEmail = "imonheit@copyright.com"



def url = "/rest/api/3/user/picker?query=${newOwnerEmail}"
def response2 = get(url).header('Content-Type', 'application/json').asObject(Map)
def newOwnerAccountID = response2.body.users.accountId[0]

if (oldOwnerAccountID.size() == 0 && newOwnerAccountID.size() == 0) {
        return "You must specify a correct email for the old owner and new owner to be able to change a filter's ownership"
}



if (filterId.size() > 0) {
    def updateFilterOwner = put("/rest/api/3/filter/${filterId}/owner")
            .header('Content-Type', 'application/json')
            .body([
                    accountId: newOwnerAccountId
            ])
            .asString()

    assert updateFilterOwner.status >= 200 && updateFilterOwner.status < 300

    //need to change
    logger.info("The filter with the Id: ${filterId} was updated to be owned by the user with the accountId of ${newOwnerAccountID}.")
}